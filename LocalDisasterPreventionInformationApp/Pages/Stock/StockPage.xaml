<ContentPage
    x:Class="LocalDisasterPreventionInformationApp.Pages.Stock.StockPage"
    x:Name="ThisPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:base="clr-namespace:LocalDisasterPreventionInformationApp.Pages.Base"
    Shell.NavBarIsVisible="False">

    <base:BasePage>
        <base:BasePage.InnerContent>
            <Grid x:Name="Inner" BindingContext ="{x:Reference ThisPage}"
                  RowDefinitions="Auto,Auto,*,Auto"
                  Padding="10">
                <!-- 期限が近い商品 -->
                <VerticalStackLayout Grid.Row="0"
                                     HorizontalOptions="Center"
                                     VerticalOptions="Start"
                                     Spacing="4">
                    <BindableLayout.ItemsSource>
                        <Binding Path="ExpiringItems"/>
                    </BindableLayout.ItemsSource>

                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding Message}"
                                   TextColor="Red"
                                   FontSize="16"
                                   Margin="0,2"
                                   HorizontalOptions="Center"/>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>

                <!-- 並べ替え -->
                <Grid Grid.Row="1" ColumnDefinitions="*,Auto" Margin="0,10">
                    <Label Text="{Binding SelectedSortName}"
                           VerticalOptions="Center"
                           FontSize="18"/>
                    <Picker x:Name="SortPicker"
                            Grid.Column="1"
                            Title="並べ替え"
                            WidthRequest="150"
                            SelectedIndexChanged="OnSortChanged">
                        <Picker.Items>
                            <x:String>商品名</x:String>
                            <x:String>カテゴリ</x:String>
                            <x:String>消費期限</x:String>
                        </Picker.Items>
                    </Picker>
                </Grid>

                <!-- 商品一覧 -->
                <CollectionView Grid.Row="2"
                                ItemsSource="{Binding Items}">
                    <CollectionView.Header>
                        <VerticalStackLayout Spacing="0">

                            <!-- ヘッダー行 -->
                            <Grid ColumnDefinitions="*,*,*,*" Padding="5" BackgroundColor="#EEEEEE">
                                <Label Grid.Column="0" Text="商品名" FontAttributes="Bold" />
                                <Label Grid.Column="1" Text="数量" FontAttributes="Bold" HorizontalOptions="Center" />
                                <Label Grid.Column="2" Text="消費期限" FontAttributes="Bold" HorizontalOptions="Center" />
                                <Label Grid.Column="3" Text="削除" FontAttributes="Bold" HorizontalOptions="Center" />
                            </Grid>

                            <!-- ★ 黒い線（1px） -->
                            <BoxView HeightRequest="1" BackgroundColor="Black" HorizontalOptions="Fill" />
                        </VerticalStackLayout>
                    </CollectionView.Header>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="*,*,*,*,*" Padding="5">
                                <!--Label Text="{Binding Category}"/-->
                                <Label Grid.Column="0" Text="{Binding ProductName}" VerticalOptions="Center"/>
                                <Label Grid.Column="1"
                                        Text="{Binding Quantity}"
                                        VerticalOptions="Center"
                                        HorizontalOptions="Center"/>
                                <VerticalStackLayout Grid.Column="2" Spacing="2">
                                    <Button Text="＋"
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            BackgroundColor="White"
                                            TextColor="Black"
                                            BorderColor="Black"
                                            BorderWidth="1"
                                            CornerRadius="5"
                                            Command="{Binding Source={x:Reference ThisPage},Path=IncreaseCommand}"
                                            CommandParameter="{Binding}"/>
                                    <Button Text="－"
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            BackgroundColor="White"
                                            TextColor="Black"
                                            BorderColor="Black"
                                            BorderWidth="1"
                                            CornerRadius="5"
                                            Command="{Binding Source={x:Reference ThisPage},Path=DecreaseCommand}"
                                            CommandParameter="{Binding}"/>
                                </VerticalStackLayout>

                                <Label Grid.Column="3" Text="{Binding ExpireDate}" VerticalOptions="Center"/>
                                
                                <!-- 削除ボタン -->
                                <ImageButton Grid.Column="4"
                                             Source="delete.png"
                                             WidthRequest="30"
                                             HeightRequest="30"
                                             Command="{Binding Source={x:Reference ThisPage}, Path=DeleteCommand}"
                                             CommandParameter="{Binding}"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- 登録ボタン -->
                <Grid Grid.Row="3">
                    <Button Text="登録"
                            HorizontalOptions="End"
                            WidthRequest="120"
                            Margin="0,10,0,0"
                            Clicked="OnRegisterClicked"/>
                </Grid>
            </Grid>
        </base:BasePage.InnerContent>
    </base:BasePage>
</ContentPage>