<ContentPage
    x:Class="LocalDisasterPreventionInformationApp.Pages.Top.TopPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:base="clr-namespace:LocalDisasterPreventionInformationApp.Pages.Base"
    Shell.NavBarIsVisible="False">

    <base:BasePage>
        <base:BasePage.InnerContent>
            <Grid>
                <WebView x:Name="MapWebView"
                         Source="map.html" 
                         Navigated="MapWebView_Navigated"/>

                <!-- 通常時の操作パネル -->
                <Border x:Name="RightPanel"
                            Background="#AAFFFFFF"
                            StrokeThickness="0"
                            HorizontalOptions="End"
                            VerticalOptions="Start"
                            Margin="10"
                            Padding="20"
                            WidthRequest="250"
                            HeightRequest="500">

                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10"/>
                    </Border.StrokeShape>


                    <VerticalStackLayout Spacing="15">

                        <!-- 検索パネル -->
                        <VerticalStackLayout Spacing="8">
                            <Picker Title="都道府県を選択" x:Name="PrefecturePicker"/>
                            <Button Text="実行"
                                x:Name="ExecuteButton"
                                Margin="0,15,0,0"
                                IsEnabled="False"
                                />
                            <!--Clicked="OnExecuteClicked"後で追加-->
                        </VerticalStackLayout>

                        <BoxView HeightRequest="1" BackgroundColor="#CCCCCC"/>

                        <Label Text="近くの避難所（10件）" FontAttributes="Bold"/>

                        <CollectionView x:Name="NearbySheltersList"
                                        SelectionMode="Single"
                                        SelectionChanged="NearbySheltersList_SelectionChanged"
                                        HeightRequest="250">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <StackLayout Padding="5"
                                                     BackgroundColor="{Binding IsSelected,Converter={StaticResource BoolToColorConver}}">
                                        <Label Text="{Binding Shelter.Name}"/>
                                        <Label Text="{Binding Distance,StringFormat='{0:F2}km'}"
                                                   FontSize="12" TextColor="Gray"/>
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

            </Grid>

        </base:BasePage.InnerContent>
    </base:BasePage>
</ContentPage>